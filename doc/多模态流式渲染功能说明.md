# ğŸ¨ GraphRAGå¤šæ¨¡æ€æµå¼æ¸²æŸ“åŠŸèƒ½è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

GraphRAGç³»ç»Ÿç°åœ¨æ”¯æŒç±»ä¼¼ChatGPTçš„å¤šæ¨¡æ€æµå¼æ¸²æŸ“æ•ˆæœï¼Œèƒ½å¤Ÿåœ¨æ™ºèƒ½é—®ç­”è¿‡ç¨‹ä¸­åŠ¨æ€å±•ç¤ºå›¾ç‰‡ã€è¡¨æ ¼ã€å›¾è¡¨ç­‰å¤šåª’ä½“å†…å®¹ï¼Œæä¾›ä¸°å¯Œçš„è§†è§‰ä½“éªŒã€‚

## ğŸ”„ å·¥ä½œæµç¨‹

### å®Œæ•´çš„å¤šæ¨¡æ€æ£€ç´¢æ¸²æŸ“é“¾è·¯

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥æŸ¥è¯¢] --> B[æŸ¥è¯¢ä¼˜åŒ–DeepSeekåˆ†æ]
    B --> C[æ··åˆæ£€ç´¢ï¼šå‘é‡+å›¾è°±]
    C --> D[ä»MySQLè·å–å¤šæ¨¡æ€æ•°æ®]
    D --> E[æ„å»ºåŒ…å«å¤šæ¨¡æ€å†…å®¹çš„ç­”æ¡ˆ]
    E --> F[å‰ç«¯æµå¼æ¸²æŸ“æ–‡æœ¬]
    F --> G[æ¸è¿›å¼æ¸²æŸ“å¤šæ¨¡æ€å†…å®¹]
    G --> H[å›¾ç‰‡é€ä¸ªæ·¡å…¥]
    G --> I[è¡¨æ ¼é€ä¸ªå±•ç¤º]
    G --> J[å›¾è¡¨é€ä¸ªåŠ è½½]
```

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šäº§å“è¯´æ˜æŸ¥è¯¢

**ç”¨æˆ·è¾“å…¥ï¼š** \"å¸®æˆ‘æŸ¥è¯¢ä¸€ä¸‹CHOç»†èƒè¡¨è¾¾ç³»ç»Ÿçš„äº§å“è¯´æ˜\"

**ç³»ç»Ÿå¤„ç†æµç¨‹ï¼š**
1. **æŸ¥è¯¢ä¼˜åŒ–**: \"å¸®æˆ‘æŸ¥è¯¢ä¸€ä¸‹CHOç»†èƒè¡¨è¾¾ç³»ç»Ÿçš„äº§å“è¯´æ˜\" â†’ \"CHOç»†èƒè¡¨è¾¾ç³»ç»Ÿ\"
2. **å‘é‡æ£€ç´¢**: åŒ¹é…ç›¸å…³æ–‡æ¡£å†…å®¹
3. **å¤šæ¨¡æ€æå–**: ä»MySQLè·å–ç›¸å…³å›¾ç‰‡ã€è¡¨æ ¼ã€å›¾è¡¨
4. **ç­”æ¡ˆç”Ÿæˆ**: ç”ŸæˆåŒ…å«æ–‡æœ¬å’Œå¤šæ¨¡æ€å¼•ç”¨çš„ç­”æ¡ˆ
5. **æµå¼æ¸²æŸ“**: 
   - å…ˆé€å­—ç¬¦æ˜¾ç¤ºæ–‡æœ¬ç­”æ¡ˆ
   - ç„¶åé€ä¸ªæ·¡å…¥æ˜¾ç¤ºç›¸å…³å›¾ç‰‡
   - æ¥ç€å±•ç¤ºäº§å“è§„æ ¼è¡¨æ ¼
   - æœ€åæ˜¾ç¤ºå·¥è‰ºæµç¨‹å›¾è¡¨

### ç¤ºä¾‹2ï¼šæŠ€æœ¯æ–‡æ¡£æŸ¥è¯¢

**ç”¨æˆ·è¾“å…¥ï¼š** \"è›‹ç™½è´¨çº¯åŒ–å·¥è‰ºçš„è¯¦ç»†æµç¨‹\"

**æ¸²æŸ“æ•ˆæœï¼š**
```
ğŸ¤– åŠ©æ‰‹æ­£åœ¨å›ç­”...

CHOç»†èƒè¡¨è¾¾ç³»ç»Ÿæ˜¯ä¸€ç§å¹¿æ³›åº”ç”¨äºç”Ÿç‰©åˆ¶è¯çš„è›‹ç™½è´¨è¡¨è¾¾å¹³å°...

[æµå¼æ˜¾ç¤ºå®Œæ–‡æœ¬åï¼Œå¼€å§‹æ¸è¿›æ¸²æŸ“å¤šæ¨¡æ€å†…å®¹]

ğŸ–¼ï¸ å›¾ç‰‡ img_001
ğŸ“· CHOç»†èƒåŸ¹å…»è®¾å¤‡å›¾
[å›¾ç‰‡æ·¡å…¥æ•ˆæœ]

ğŸ“Š è¡¨æ ¼ table_001  
ç”Ÿäº§å·¥è‰ºå‚æ•°å¯¹ç…§è¡¨
[è¡¨æ ¼ä»ä¸Šåˆ°ä¸‹é€è¡Œæ˜¾ç¤º]

ğŸ“ˆ å›¾è¡¨ chart_001
çº¯åŒ–å·¥è‰ºæµç¨‹ç¤ºæ„å›¾
[å›¾è¡¨æè¿°æ¸è¿›æ˜¾ç¤º]
```

## ğŸ”§ æŠ€æœ¯å®ç°

### åç«¯å¢å¼º (SearchService.py)

#### 1. å¤šæ¨¡æ€æ•°æ®æå–
```python
def question_answering(self, question: str, context_limit: int = 5):
    # æ£€ç´¢ç›¸å…³æ–‡æ¡£
    search_results = self.hybrid_search(question, top_k=context_limit)
    
    # æå–å¤šæ¨¡æ€å†…å®¹
    multimodal_content = {
        'images': [],
        'tables': [], 
        'charts': []
    }
    
    for result in search_results['combined_results']:
        if 'chunk_id' in result:
            chunk_multimodal = self._get_chunk_multimodal_content(result['chunk_id'])
            if chunk_multimodal:
                multimodal_content['images'].extend(chunk_multimodal.get('img', []))
                multimodal_content['tables'].extend(chunk_multimodal.get('table', []))
                multimodal_content['charts'].extend(chunk_multimodal.get('chars', []))
```

#### 2. è¿”å›æ ¼å¼å¢å¼º
```python
result = {
    'question': question,
    'answer': answer,
    'context': relevant_docs,
    'search_results': search_results,
    'multimodal_content': multimodal_content,  # ğŸ”¥ æ–°å¢å¤šæ¨¡æ€æ•°æ®
    'query_optimization': query_optimization_info,
    'timestamp': datetime.now().isoformat()
}
```

### å‰ç«¯æ¸²æŸ“ (main.js)

#### 1. æ¸è¿›å¼æµå¼æ¸²æŸ“
```javascript
async streamMessage(content, multimodalContent = null) {
    // ç¬¬ä¸€é˜¶æ®µï¼šæµå¼æ˜¾ç¤ºæ–‡æœ¬å†…å®¹
    // ç¬¬äºŒé˜¶æ®µï¼šæ¸è¿›æ¸²æŸ“å¤šæ¨¡æ€å†…å®¹
    await this.progressiveRenderMultimodal(contentDiv, content, multimodalContent);
}
```

#### 2. å¤šæ¨¡æ€å†…å®¹è§£æ
```javascript
renderMultimodalContent(multimodalContent) {
    let elements = [];
    
    // æ¸²æŸ“å›¾ç‰‡
    if (multimodalContent.images && multimodalContent.images.length > 0) {
        elements.push(this.renderImages(multimodalContent.images));
    }
    
    // æ¸²æŸ“è¡¨æ ¼
    if (multimodalContent.tables && multimodalContent.tables.length > 0) {
        elements.push(this.renderTables(multimodalContent.tables));
    }
    
    // æ¸²æŸ“å›¾è¡¨
    if (multimodalContent.charts && multimodalContent.charts.length > 0) {
        elements.push(this.renderCharts(multimodalContent.charts));
    }
    
    return elements.length > 0 ? 
        `<div class=\"multimodal-content\">${elements.join('')}</div>` : '';
}
```

#### 3. æµå¼æ¸²æŸ“åŠ¨ç”»
```javascript
async streamRenderImages(container, images) {
    for (let i = 0; i < images.length; i++) {
        const imageItem = document.createElement('div');
        imageItem.className = 'multimodal-item image-item fade-in';
        
        container.appendChild(imageItem);
        this.scrollToBottom();
        await this.delay(300);  // é€ä¸ªæ˜¾ç¤ºï¼Œé—´éš”300ms
    }
}
```

### CSSæ ·å¼ (style.css)

#### 1. æµå¼åŠ è½½åŠ¨ç”»
```css
.multimodal-content.streaming {
    border-left: 3px solid var(--accent-primary);
    animation: streaming-pulse 1.5s ease-in-out infinite;
}

@keyframes streaming-pulse {
    0%, 100% { border-left-color: var(--accent-primary); }
    50% { border-left-color: var(--accent-hover); }
}
```

#### 2. æ·¡å…¥æ•ˆæœ
```css
.multimodal-item {
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s ease;
}

.multimodal-item.fade-in {
    animation: fadeInUp 0.5s ease forwards;
}

@keyframes fadeInUp {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
```

## ğŸ“Š æ•°æ®ç»“æ„è¯´æ˜

### å¤šæ¨¡æ€å†…å®¹æ•°æ®æ ¼å¼

```json
{
  \"multimodal_content\": {
    \"images\": [
      {
        \"element_id\": \"img_001\",
        \"file_path\": \"/upload/images/cho_system.jpg\",
        \"description\": \"CHOç»†èƒè¡¨è¾¾ç³»ç»Ÿç¤ºæ„å›¾\",
        \"page_number\": 1,
        \"coordinates\": {\"x\": 100, \"y\": 200}
      }
    ],
    \"tables\": [
      {
        \"element_id\": \"table_001\",
        \"title\": \"ç”Ÿäº§å·¥è‰ºå‚æ•°è¡¨\",
        \"summary\": \"CHOç»†èƒåŸ¹å…»çš„å…³é”®å‚æ•°å¯¹ç…§\",
        \"table_data\": [
          {\"å‚æ•°\": \"æ¸©åº¦\", \"æ•°å€¼\": \"37Â°C\", \"èŒƒå›´\": \"36-38Â°C\"},
          {\"å‚æ•°\": \"pH\": \"7.2\", \"èŒƒå›´\": \"7.0-7.4\"}
        ]
      }
    ],
    \"charts\": [
      {
        \"element_id\": \"chart_001\",
        \"description\": \"è›‹ç™½è´¨çº¯åŒ–å·¥è‰ºæµç¨‹å›¾ï¼Œå±•ç¤ºäº†ä»ç»†èƒåŸ¹å…»åˆ°æœ€ç»ˆäº§å“çš„å®Œæ•´æµç¨‹\"
      }
    ]
  }
}
```

## ğŸ¨ æ¸²æŸ“æ•ˆæœç‰¹ç‚¹

### 1. **ChatGPTé£æ ¼çš„æµå¼ä½“éªŒ**
- âœ… æ–‡æœ¬é€å­—ç¬¦æµå¼æ˜¾ç¤º
- âœ… å¤šæ¨¡æ€å†…å®¹æ¸è¿›å¼åŠ è½½
- âœ… å¹³æ»‘çš„åŠ¨ç”»è¿‡æ¸¡æ•ˆæœ
- âœ… è‡ªåŠ¨æ»šåŠ¨è·Ÿéš

### 2. **ä¸°å¯Œçš„è§†è§‰å…ƒç´ **
- ğŸ–¼ï¸ **å›¾ç‰‡å±•ç¤º**: æ”¯æŒç¼©æ”¾ã€åŠ è½½å ä½ç¬¦ã€é”™è¯¯å¤„ç†
- ğŸ“Š **è¡¨æ ¼æ¸²æŸ“**: å“åº”å¼è¡¨æ ¼ã€ç²˜æ€§è¡¨å¤´ã€æ‚¬åœæ•ˆæœ
- ğŸ“ˆ **å›¾è¡¨æè¿°**: æ¸…æ™°çš„å›¾è¡¨è¯´æ˜å’Œå¼•ç”¨
- ğŸ”— **å†…è”å¼•ç”¨**: æ”¯æŒç‚¹å‡»è·³è½¬çš„å¤šæ¨¡æ€å¼•ç”¨

### 3. **ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒ**
- ğŸ“± **å“åº”å¼è®¾è®¡**: ç§»åŠ¨ç«¯å‹å¥½çš„å¸ƒå±€
- ğŸ¯ **æ— éšœç¢è®¿é—®**: è¯­ä¹‰åŒ–HTMLç»“æ„
- ğŸ¨ **æš—é»‘ä¸»é¢˜**: ç»Ÿä¸€çš„è®¾è®¡é£æ ¼
- âš¡ **æ€§èƒ½ä¼˜åŒ–**: æ¸è¿›åŠ è½½ï¼Œé¿å…é˜»å¡

## ğŸš€ ä½¿ç”¨å»ºè®®

### 1. **æŸ¥è¯¢ä¼˜åŒ–å»ºè®®**
- ä½¿ç”¨å…·ä½“çš„ä¸“ä¸šæœ¯è¯­ (å¦‚\"CHOç»†èƒ\", \"è›‹ç™½è´¨çº¯åŒ–\")
- é¿å…æ¨¡ç³Šçš„ä¿®é¥°è¯ (å¦‚\"å¸®æˆ‘æŸ¥è¯¢\", \"ç›¸å…³å†…å®¹\")
- é’ˆå¯¹å¤šåª’ä½“å†…å®¹çš„æŸ¥è¯¢æ•ˆæœæ›´ä½³

### 2. **å†…å®¹ç»„ç»‡å»ºè®®**
- ç¡®ä¿PDFæ–‡æ¡£åŒ…å«æ¸…æ™°çš„å›¾ç‰‡å’Œè¡¨æ ¼
- ä½¿ç”¨ç»“æ„åŒ–çš„æ ‡é¢˜å’Œè¯´æ˜æ–‡å­—
- ä¿æŒå›¾ç‰‡è·¯å¾„çš„æ­£ç¡®æ€§

### 3. **æ€§èƒ½è€ƒè™‘**
- å¤šæ¨¡æ€å†…å®¹è¾ƒå¤šæ—¶ä¼šå¢åŠ åŠ è½½æ—¶é—´
- å›¾ç‰‡æ–‡ä»¶å»ºè®®å‹ç¼©ä¼˜åŒ–
- è¡¨æ ¼æ•°æ®é‡å¤§æ—¶ä¼šå½±å“æ¸²æŸ“æ€§èƒ½

## ğŸ”® æœªæ¥æ‰©å±•

### è®¡åˆ’ä¸­çš„å¢å¼ºåŠŸèƒ½
1. **å®æ—¶é¢„è§ˆ**: æ‚¬åœæ˜¾ç¤ºå¤šæ¨¡æ€å†…å®¹é¢„è§ˆ
2. **å…¨å±æŸ¥çœ‹**: ç‚¹å‡»å›¾ç‰‡/è¡¨æ ¼è¿›å…¥å…¨å±æ¨¡å¼
3. **å†…å®¹å¯¼å‡º**: æ”¯æŒå¯¼å‡ºåŒ…å«å¤šæ¨¡æ€å†…å®¹çš„æŠ¥å‘Š
4. **æ™ºèƒ½æ ‡æ³¨**: AIè‡ªåŠ¨ä¸ºå›¾ç‰‡ç”Ÿæˆæ›´è¯¦ç»†çš„æè¿°
5. **äº¤äº’å¼å›¾è¡¨**: æ”¯æŒå¯äº¤äº’çš„æ•°æ®å›¾è¡¨

é€šè¿‡è¿™ä¸ªå¤šæ¨¡æ€æµå¼æ¸²æŸ“åŠŸèƒ½ï¼ŒGraphRAGç³»ç»Ÿç°åœ¨èƒ½å¤Ÿæä¾›æ›´åŠ ä¸°å¯Œã€ç›´è§‚çš„æ™ºèƒ½é—®ç­”ä½“éªŒï¼Œè®©ç”¨æˆ·ä¸ä»…èƒ½è·å¾—æ–‡æœ¬ç­”æ¡ˆï¼Œè¿˜èƒ½çœ‹åˆ°ç›¸å…³çš„å›¾ç‰‡ã€è¡¨æ ¼ç­‰è§†è§‰å†…å®¹ï¼ŒçœŸæ­£å®ç°äº†å¤šæ¨¡æ€æ™ºèƒ½æ£€ç´¢çš„ç›®æ ‡ã€‚ğŸ‰
